var Truco = function() {
    var Mazo = require('Mazo');
    var self = {};
    // ------------------------------------
    var JUGADOR_1 = 0, JUGADOR_2 = 1;
    var turno, ultimoQueRepartio;
    var unMazo, cartasJugador1, cartasJugador2;
    var puntosJugador1, puntosJugador2;

    self.empezar = function() {
    	puntosJugador1 = 0;
        puntosJugador2 = 0;
        ultimoQueRepartio = JUGADOR_1;
        nuevaMano();
    }

    self.getCartasJugador1 = function() {
        return cartasJugador1;
    }

    self.getCartasJugador2 = function() {
        return cartasJugador2;
    }

    function avanzarTurno() {
        turno = (turno + 1) % 2;
    }

    function avanzarUltimoQueRepartio() {
        ultimoQueRepartio = (ultimoQueRepartio + 1) % 2;
    }

    function nuevaMano() {
    	unMazo = new Mazo.crear();
        unMazo.mezclar();
        repartirCartas();
    }

    function  repartirCartas() {
    	cartasJugador1 = [];
    	cartasJugador2 = [];

        cartasJugador1.push(pedirCartaDeTruco(unMazo));
        cartasJugador1.push(pedirCartaDeTruco(unMazo));
        cartasJugador1.push(pedirCartaDeTruco(unMazo));
        
        cartasJugador2.push(pedirCartaDeTruco(unMazo));
        cartasJugador2.push(pedirCartaDeTruco(unMazo));
        cartasJugador2.push(pedirCartaDeTruco(unMazo));

        turno = ultimoQueRepartio;
        avanzarUltimoQueRepartio();
    }
    
    function obtenerValorCarta(unaCarta) {
        var valor = 0;

        switch (unaCarta.numero) {
            case 1:
                if ((unaCarta.palo == "copa") || (unaCarta.palo == "oro")) {
                    valor = 7;
                } else {
                    if (unaCarta.palo == "basto") {
                        valor = 12;
                    } else {
                        valor = 13;
                    }
                }
            break;
            case 2:
                valor = 8;
            break;
            case 3:
                valor = 9;
            break;
            case 4:
                valor = 0;
            break;
            case 5:
                valor = 1;
            break;
            case 6:
                valor = 2;
            break;
            case 7:
                if ((unaCarta.palo == "copa") || (unaCarta.palo == "basto")) {
                    valor = 3;
                } else {
                    if (unaCarta.palo == "oro") {
                        valor = 10;
                    } else {
                        valor = 11;
                    }
                }
            break;
            case 10:
                valor = 4;
            break;
            case 11:
                valor = 5;
            break;
            case 12:
                valor = 6;
            break;
        }

        return valor;
    }

    function obtenerValorEnvidoCarta(unaCarta) {
        if (unaCarta.numero > 7) {
            return 0;
        } else {
            return unaCarta.numero;
        }
    }

    function pedirCartaDeTruco(unMazo) {
        var unaCarta = unMazo.pedirCarta();

        while ((unaCarta.numero == 8) || (unaCarta.numero == 9)) {
            unaCarta = unMazo.pedirCarta();
        }

        return unaCarta;
    }

    return self;
}

module.exports.crear = Truco;