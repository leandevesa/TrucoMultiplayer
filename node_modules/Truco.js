var Truco = function(unosJugadores) {
    var Mazo = require('Mazo');
    // ------------------------------------
    var jugadores = unosJugadores;
    var cantJugadores = unosJugadores.length;
    var turno, ultimoQueRepartio;
    var unMazo;

    var self = {

        nuevaPartida: function() {
            turno = 0;
            ultimoQueRepartio = 0;
            nuevaMano();
        },
        getJugadores: function() {
            return jugadores;
        }

    };

    function avanzarTurno() {
        turno = (turno + 1) % cantJugadores;
    }

    function avanzarUltimoQueRepartio() {
        ultimoQueRepartio = (ultimoQueRepartio + 1) % cantJugadores;
    }

    function nuevaMano() {
    	unMazo = new Mazo.crear();
        unMazo.mezclar();
        repartirCartas();
    }

    function  repartirCartas() {
        for (var i = 0; i < jugadores.length; i++) {
            jugadores[i].cartas.push(pedirCartaDeTruco(unMazo));
            jugadores[i].cartas.push(pedirCartaDeTruco(unMazo));
            jugadores[i].cartas.push(pedirCartaDeTruco(unMazo));
        }
    }
    
    function obtenerValorCarta(unaCarta) {
        var valor = 0;

        switch (unaCarta.numero) {
            case 1:
                if ((unaCarta.palo == "copa") || (unaCarta.palo == "oro")) {
                    valor = 7;
                } else {
                    if (unaCarta.palo == "basto") {
                        valor = 12;
                    } else {
                        valor = 13;
                    }
                }
            break;
            case 2:
                valor = 8;
            break;
            case 3:
                valor = 9;
            break;
            case 4:
                valor = 0;
            break;
            case 5:
                valor = 1;
            break;
            case 6:
                valor = 2;
            break;
            case 7:
                if ((unaCarta.palo == "copa") || (unaCarta.palo == "basto")) {
                    valor = 3;
                } else {
                    if (unaCarta.palo == "oro") {
                        valor = 10;
                    } else {
                        valor = 11;
                    }
                }
            break;
            case 10:
                valor = 4;
            break;
            case 11:
                valor = 5;
            break;
            case 12:
                valor = 6;
            break;
        }

        return valor;
    }

    function obtenerValorEnvidoCarta(unaCarta) {
        if (unaCarta.numero > 7) {
            return 0;
        } else {
            return unaCarta.numero;
        }
    }

    function pedirCartaDeTruco(unMazo) {
        var unaCarta = unMazo.pedirCarta();

        while ((unaCarta.numero == 8) || (unaCarta.numero == 9)) {
            unaCarta = unMazo.pedirCarta();
        }

        return unaCarta;
    }

    return self;
}

module.exports.crear = Truco;